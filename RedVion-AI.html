<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>RedVion AI â€” Desktop</title>
<style>
:root{
  --bg:#0f1115;--panel:#16171b;--muted:#9aa6b2;--accent:#4ea8de;--bot:#2b2b2f;
}
html,body{height:100%;margin:0;background:var(--bg);color:#e6eef6;font-family:Inter,system-ui,Segoe UI,Helvetica,Arial;overflow:hidden}
.app{display:flex;height:100vh;gap:12px;padding:12px;box-sizing:border-box;display:none;transition:opacity 0.5s;}
.sidebar{width:220px;background:linear-gradient(180deg,#141516,#101113);border-radius:12px;padding:12px;box-shadow:0 8px 30px rgba(0,0,0,0.6);display:flex;flex-direction:column;gap:10px}
.logo{display:flex;align-items:center;gap:10px}
.logo img{width:40px;height:40px;border-radius:8px}
.logo h1{font-size:16px;margin:0}
.side-btn{background:transparent;border:1px solid rgba(255,255,255,0.03);color:var(--muted);padding:8px;border-radius:8px;text-align:left;cursor:pointer;font-size:14px}
.side-btn.active{outline:2px solid rgba(78,168,222,0.12);color:#cfe3f9}
.small{font-size:13px;color:var(--muted)}
.recent-list{margin-top:6px;overflow:auto;max-height:42vh;display:flex;flex-direction:column;gap:6px}
.recent-item{background:rgba(255,255,255,0.02);padding:8px;border-radius:8px;cursor:pointer;color:#dbe9ff;display:flex;align-items:center;gap:6px}
.main{flex:1;display:flex;flex-direction:column;border-radius:12px;overflow:hidden;background:linear-gradient(180deg,#0b0c0f,#0e1013);box-shadow:0 10px 40px rgba(0,0,0,0.6)}
.header{height:56px;display:flex;align-items:center;gap:12px;padding:10px 16px;background:linear-gradient(90deg,#15161a,#0f1114)}
.header h2{margin:0;font-size:16px;color:#f3f6fa}
.body{display:flex;flex:1;overflow:hidden}
.chat-panel{flex:1;display:flex;flex-direction:column;min-width:0}
.chat-window{flex:1;padding:18px;overflow:auto;display:flex;flex-direction:column;gap:10px}
.bubble{max-width:72%;padding:12px 14px;border-radius:14px;line-height:1.45;word-break:break-word}
.user{align-self:flex-end;background:#2f3337;color:#eaf6ff;border-bottom-right-radius:6px}
.ai{align-self:flex-start;background:var(--bot);color:#e6eef6;border-bottom-left-radius:6px;white-space:pre-wrap}
.ai img,.ai video{border-radius:8px;max-width:100%;margin-top:6px;box-shadow:0 4px 12px rgba(0,0,0,0.4);}
.thinking{align-self:flex-start;color:var(--muted);font-style:italic;display:flex;gap:4px;}
.thinking span{display:inline-block;width:6px;height:6px;background:var(--muted);border-radius:50%;animation:dot 1.2s infinite ease-in-out;}
.thinking span:nth-child(1){animation-delay:0s;}
.thinking span:nth-child(2){animation-delay:0.2s;}
.thinking span:nth-child(3){animation-delay:0.4s;}
@keyframes dot{0%,80%,100%{transform:scale(0);}40%{transform:scale(1);}}
.terminal{background:#0b0c0f;border:1px solid rgba(255,255,255,0.03);padding:12px;border-radius:8px;color:#cfe3f9;font-family:monospace;white-space:pre;max-width:84%}
.terminal .toolbar{display:flex;gap:8px;margin-bottom:8px}
.copy-btn{background:#1f6a8f;border:none;padding:6px 10px;border-radius:6px;color:#fff;cursor:pointer}
.input-area{display:flex;gap:8px;padding:12px;border-top:1px solid rgba(255,255,255,0.02);align-items:flex-end;background:linear-gradient(180deg,#0b0c0f,#0e1013)}
textarea.input{flex:1;min-height:42px;max-height:160px;resize:none;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:#0e1216;color:#e6eef6;overflow:auto}
.icon-btn{background:transparent;border:1px solid rgba(255,255,255,0.03);padding:8px;border-radius:10px;cursor:pointer;color:var(--muted)}
.modal{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);background:#0e1114;padding:14px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);box-shadow:0 10px 40px rgba(0,0,0,0.7);z-index:50;min-width:320px;display:none;}
.modal h3{margin:0 0 8px 0;}
.modal .close{float:right;cursor:pointer;}
.modal input{width:100%;padding:8px;margin-top:4px;border-radius:6px;border:1px solid #555;background:#111;color:#fff;}
.modal button{margin-top:8px;padding:6px 12px;border-radius:6px;background:#4ea8de;color:#fff;border:none;cursor:pointer;}
#startupScreen{position:fixed;top:0;left:0;width:100%;height:100%;background:var(--bg);display:flex;align-items:center;justify-content:center;flex-direction:column;z-index:1000;color:#fff;font-family:Arial, sans-serif;transition:opacity 0.8s;}
#startupScreen h1{font-size:48px;margin:0;animation:flicker 1.5s infinite;}
@keyframes flicker{
  0%,19%,21%,23%,25%,54%,56%,100%{opacity:1;}
  20%,22%,24%,55%{opacity:0.2;}
}
</style>
</head>
<body>

<!-- Startup -->
<div id="startupScreen">
  <h1>RedVion-AI Chat With Fun</h1>
  <p>Loading AI...</p>
</div>

<div class="app">
  <div class="sidebar">
    <div class="logo">
      <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='64' height='64'><rect rx='12' width='64' height='64' fill='%23d946ef'/><text x='50%' y='54%' font-size='28' font-family='Arial' text-anchor='middle' fill='white'>R</text></svg>" alt="RedVion"/>
      <div>
        <h1>RedVion</h1>
        <div class="small">AI Assistant</div>
      </div>
    </div>
    <button class="side-btn" onclick="newChat()">âž• New Chat</button>
    <button class="side-btn" onclick="openApiModal()">ðŸ”‘ API Keys</button>
    <div style="margin-top:6px"><div class="small">Recent</div></div>
    <div class="recent-list" id="recentList"></div>
    <div style="flex:1"></div>
    <div class="small" style="text-align:center">v1 Â· Offline UI</div>
  </div>

  <div class="main">
    <div class="header"><h2 id="chatTitle">New Chat</h2></div>
    <div class="body">
      <div class="chat-panel">
        <div class="chat-window" id="chatWindow"></div>
        <div class="input-area">
          <input type="file" id="fileInput" style="display:none" multiple onchange="handleFiles(event)"/>
          <textarea id="userInput" class="input" placeholder="Type a message... (Enter = send)"></textarea>
          <div style="display:flex;gap:6px;align-items:center">
            <button class="icon-btn" onclick="document.getElementById('fileInput').click()">ðŸ“Ž</button>
            <button class="icon-btn" onclick="startVoice()">ðŸŽ¤</button>
            <button class="icon-btn" onclick="send()">âž¤</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- API Modal -->
<div class="modal" id="apiModal">
  <span class="close" onclick="closeApiModal()">âœ–</span>
  <h3>Set API Keys</h3>
  <label>ChatGPT API Key:</label>
  <input type="text" id="chatApiInput" placeholder="Enter Chat API Key">
  <label>DeepAI API Key:</label>
  <input type="text" id="deepApiInput" placeholder="Enter DeepAI API Key">
  <button onclick="saveApiKeys()">Save Keys</button>
  <button style="background:#e53e3e;margin-top:4px;" onclick="removeApiKeys()">Remove Keys Permanently</button>
</div>

<script>
let API_KEY="", DEEPAPI_KEY="", chats=JSON.parse(localStorage.getItem('rv_chats_v1')||'[]'), current={title:"New Chat",messages:[]}, tts=false, thinking=false;
const chatWindow=document.getElementById('chatWindow'), recentList=document.getElementById('recentList'), chatTitleEl=document.getElementById('chatTitle'), userInput=document.getElementById('userInput');

// Load saved keys if present
(function(){
  const c=localStorage.getItem('rv_api_key'), d=localStorage.getItem('rv_deepai_key');
  if(c){API_KEY=c; document.getElementById('chatApiInput').value=c;}
  if(d){DEEPAPI_KEY=d; document.getElementById('deepApiInput').value=d;}
})();

// Startup animation
window.addEventListener('load',()=>{ setTimeout(()=>{ const start=document.getElementById('startupScreen'); start.style.opacity='0'; setTimeout(()=>{ start.style.display='none'; document.querySelector('.app').style.display='flex'; renderRecent(); },800); },1500);});

// API Modal
function openApiModal(){document.getElementById('apiModal').style.display='block';}
function closeApiModal(){document.getElementById('apiModal').style.display='none';}
function saveApiKeys(){ 
  API_KEY=document.getElementById('chatApiInput').value.trim(); 
  DEEPAPI_KEY=document.getElementById('deepApiInput').value.trim();
  if(!API_KEY||!DEEPAPI_KEY){alert('Both keys required'); return;} 
  localStorage.setItem('rv_api_key',API_KEY); 
  localStorage.setItem('rv_deepai_key',DEEPAPI_KEY); 
  alert('API keys saved'); 
  closeApiModal();
}
function removeApiKeys(){
  localStorage.removeItem('rv_api_key'); 
  localStorage.removeItem('rv_deepai_key'); 
  API_KEY=""; DEEPAPI_KEY="";
  document.getElementById('chatApiInput').value="";
  document.getElementById('deepApiInput').value="";
  alert('API keys removed permanently');
}

// Chat
function addUserBubble(t){const d=document.createElement('div');d.className='bubble user';d.textContent=t;chatWindow.appendChild(d);chatWindow.scrollTop=chatWindow.scrollHeight;}
function addAIBubble(t,m={}){const d=document.createElement('div'); d.className='bubble ai'; d.textContent=t; if(m.image){const img=document.createElement('img'); img.src=m.imageUrl; d.appendChild(img);} if(m.video){const vid=document.createElement('video'); vid.src=""; vid.controls=true; vid.style.height="200px"; d.appendChild(vid);} chatWindow.appendChild(d); chatWindow.scrollTop=chatWindow.scrollHeight; if(tts)speakText(t);}
function showThinking(){thinking=true; const d=document.createElement('div'); d.className='bubble thinking'; d.id='thinkingBubble'; d.innerHTML='<span></span><span></span><span></span>'; chatWindow.appendChild(d); chatWindow.scrollTop=chatWindow.scrollHeight;}
function hideThinking(){thinking=false; const e=document.getElementById('thinkingBubble'); if(e)e.remove();}
userInput.addEventListener('keydown',e=>{if(e.key==='Enter'){e.preventDefault();send();}});

// Send
async function send(){if(thinking)return; const t=userInput.value.trim(); if(!t)return; addUserBubble(t); current.messages.push({role:'user',content:t}); userInput.value=''; if(current.title==='New Chat'){current.title=t.slice(0,40); chatTitleEl.textContent=current.title;} showThinking();
try{ const res=await fetch("https://api.openai.com/v1/chat/completions",{method:'POST',headers:{'Content-Type':'application/json','Authorization':`Bearer ${API_KEY}`}, body:JSON.stringify({model:"gpt-4o-mini",messages:current.messages})});
const d=await res.json(); hideThinking(); const r=d.choices?.[0]?.message?.content||'No reply'; current.messages.push({role:'assistant',content:r}); addAIBubble(r); saveChats(); renderRecent();
}catch(err){hideThinking(); addAIBubble('Network error: '+err.message);}}

// Save/load
function saveChats(){localStorage.setItem('rv_chats_v1',JSON.stringify(chats));}
function newChat(){if(current.messages.length){chats.push(current); saveChats(); renderRecent();} current={title:"New Chat",messages:[]}; chatTitleEl.textContent=current.title; chatWindow.innerHTML='';}
function renderRecent(){recentList.innerHTML=''; chats.slice().reverse().forEach((c,i)=>{ const idx=chats.length-1-i; const d=document.createElement('div'); d.className='recent-item'; d.textContent=c.title; d.onclick=()=>{current=JSON.parse(JSON.stringify(chats[idx])); chatTitleEl.textContent=current.title; chatWindow.innerHTML=''; current.messages.forEach(m=>{if(m.role==='user') addUserBubble(m.content); else addAIBubble(m.content);});}; recentList.appendChild(d);});}

// TTS
function speakText(txt){try{const u=new SpeechSynthesisUtterance(txt); u.lang='en-US'; speechSynthesis.speak(u);}catch(e){}}

// Files
function handleFiles(ev){Array.from(ev.target.files).forEach(f=>{ const r=new FileReader(); r.onload=e=>{ addUserBubble(`File ${f.name} uploaded`); current.messages.push({role:'user',content:`File ${f.name} content:\n${e.target.result}`}); send();}; if(f.type.startsWith('text')||f.name.match(/\.(txt|md|csv|json|html|js|css)$/i)){ r.readAsText(f); } else { r.readAsDataURL(f); } });}

// Voice
function startVoice(){const SR=window.SpeechRecognition||window.webkitSpeechRecognition; if(!SR){alert('No speech recognition'); return;} const rec=new SR(); rec.lang='en-US'; rec.interimResults=false; rec.onresult=e=>{userInput.value=e.results[0][0].transcript; send();}; rec.onerror=e=>{alert('Speech error: '+e.error);}; rec.start();}

// DeepAI Image
async function promptImage(){const p=prompt("Enter image prompt:"); if(!p)return; if(!DEEPAPI_KEY){alert('Set DeepAI key'); return;} showThinking();
try{ const res=await fetch("https://api.deepai.org/api/text2img",{method:'POST',headers:{"Api-Key":DEEPAPI_KEY,"Content-Type":"application/x-www-form-urlencoded"},body:`text=${encodeURIComponent(p)}`}); const d=await res.json(); hideThinking(); if(!d.output_url){addAIBubble('Image generation failed'); return;} const img=document.createElement('img'); img.src=d.output_url; img.className='bubble ai'; chatWindow.appendChild(img); chatWindow.scrollTop=chatWindow.scrollHeight; current.messages.push({role:'assistant',content:`[Image generated] ${p}`,meta:{image:true,imageUrl:d.output_url}}); }catch(err){hideThinking(); addAIBubble('Image generation failed: '+err.message);}}
</script>
</body>
</html>
